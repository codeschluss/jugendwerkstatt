"use strict";(self.webpackChunkjugendwerkstatt=self.webpackChunkjugendwerkstatt||[]).push([[735],{15735:function(e,t,i){i.r(t);var l=i(93433),n=i(1413),d=i(37762),a=i(15861),o=i(29439),r=i(87757),s=i.n(r),u=i(72791),v=i(61134),c=i(16871),f=i(35820),m=i(7043),p=i(77260),h=i(1841),b=i(80822),g=i(97892),x=i.n(g),j=i(99374),D=i(14720),y=i(80184);t.default=function(){var e=(0,c.UO)().id,t=(0,c.s0)(),i=(0,u.useState)(null),r=(0,o.Z)(i,2),g=r[0],k=r[1],Z=(0,u.useState)(null),O=(0,o.Z)(Z,2),w=O[0],N=O[1],S=(0,u.useState)([]),I=(0,o.Z)(S,2),T=I[0],_=I[1],z=(0,h.lCI)({variables:{entity:{id:e}},skip:!e}).data,C=(z=void 0===z?{}:z).getEvent,U=void 0===C?null:C,Q=(0,h.CNQ)({onCompleted:function(){return t("/admin/events")}}),R=(0,o.Z)(Q,2),L=R[0],E=R[1].loading,A=(0,v.cI)({resolver:(0,f.L)(b.mO),defaultValues:U?{}:{schedule:{start_date:x()().startOf("date").toDate(),end_date:x()().startOf("date").toDate(),end_repeat:x()().startOf("date").toDate(),start_hour:x()().startOf("h").toDate(),end_hour:x()().startOf("h").toDate()},files:[{file:null}]}}),B=A.formState.errors,V=A.handleSubmit,G=A.register,J=A.reset,q=A.control,H=(0,v.Dq)({name:"files",control:q}),M=H.fields,F=H.append,K=H.remove,P=H.update,W=function(){var e=(0,a.Z)(s().mark((function e(t){var i,l,a,o,r,u,v,c,f,m,p,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=t.baseData,a=l.name,o=l.category,r=l.organizer,u=t.address,v=t.description,c=[],f=(0,d.Z)(M),e.prev=3,f.s();case 5:if((m=f.n()).done){e.next=14;break}if(!(p=m.value).file||0===p.file.size){e.next=12;break}return e.next=10,(0,j.GJ)(p.file);case 10:h=e.sent,c.push(h);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),f.e(e.t0);case 19:return e.prev=19,f.f(),e.finish(19);case 22:if(e.t1=L,e.t2=n.Z,e.t3=n.Z,e.t4={name:a,images:c,address:u,schedules:T,description:v,category:{id:o},organizer:{id:r}},e.t5=!(null===w||void 0===w||!w.file)&&0!==(null===g||void 0===g||null===(i=g.file)||void 0===i?void 0:i.size),!e.t5){e.next=32;break}return e.next=30,(0,j.GJ)(w.file);case 30:e.t6=e.sent,e.t5={titleImage:e.t6};case 32:e.t7=e.t5,e.t8=(0,e.t3)(e.t4,e.t7),e.t9=!!U&&{id:null===U||void 0===U?void 0:U.id},e.t10=(0,e.t2)(e.t8,e.t9),e.t11={entity:e.t10},e.t12={variables:e.t11},(0,e.t1)(e.t12);case 39:case"end":return e.stop()}}),e,null,[[3,16,19,22]])})));return function(t){return e.apply(this,arguments)}}(),X=function(e,t){P(e,{file:t}),F({file:null})},Y=function(e){return function(){k(e)}};return(0,u.useEffect)((function(){if(console.log("getEvent",U),U){var e,t,i,n,d,a,o,r,s,u,v,c,f,m=null===(e=U.schedules)||void 0===e?void 0:e.map((function(e){return{startDate:null===e||void 0===e?void 0:e.startDate,endDate:null===e||void 0===e?void 0:e.endDate}}));_(m||[]);var p=(null===U||void 0===U||null===(t=U.images)||void 0===t?void 0:t.map((function(e){return{file:(0,j.vy)((null===e||void 0===e?void 0:e.base64)||"",(null===e||void 0===e?void 0:e.mimeType)||"",(null===e||void 0===e?void 0:e.name)||"")}})))||[];J({baseData:{name:(null===U||void 0===U?void 0:U.name)||"",category:(null===U||void 0===U||null===(i=U.category)||void 0===i?void 0:i.id)||"",organizer:(null===U||void 0===U||null===(n=U.organizer)||void 0===n?void 0:n.id)||""},description:(null===U||void 0===U?void 0:U.description)||"",address:{houseNumber:(null===U||void 0===U||null===(d=U.address)||void 0===d?void 0:d.houseNumber)||"",place:(null===U||void 0===U||null===(a=U.address)||void 0===a?void 0:a.place)||"",postalCode:(null===U||void 0===U||null===(o=U.address)||void 0===o?void 0:o.postalCode)||"",street:(null===U||void 0===U||null===(r=U.address)||void 0===r?void 0:r.street)||""},schedule:{start_date:x()().startOf("date").toDate(),end_date:x()().startOf("date").toDate(),end_repeat:x()().startOf("date").toDate(),start_hour:x()().startOf("h").toDate(),end_hour:x()().startOf("h").toDate()},files:[].concat((0,l.Z)(p),[{file:null}])});var h=(0,j.vy)((null===U||void 0===U||null===(s=U.titleImage)||void 0===s?void 0:s.base64)||"",(null===U||void 0===U||null===(u=U.titleImage)||void 0===u?void 0:u.mimeType)||"",(null===U||void 0===U||null===(v=U.titleImage)||void 0===v?void 0:v.name)||"");N({id:(null===U||void 0===U||null===(c=U.titleImage)||void 0===c?void 0:c.id)||"",file:h}),k({file:h,id:(null===U||void 0===U||null===(f=U.titleImage)||void 0===f?void 0:f.id)||""})}}),[U,J]),(0,y.jsx)(v.RV,(0,n.Z)((0,n.Z)({},A),{},{children:(0,y.jsxs)("form",{className:"min-h-full",children:[(0,y.jsx)(m.UQ,{title:"Stammdaten",open:!!e,className:(0,j.Tn)(B.baseData&&"border border-primary"),children:(0,y.jsx)(p.EM,{})}),(0,y.jsx)(m.UQ,{title:"Adresse",className:(0,j.Tn)(B.address&&"border border-primary"),children:(0,y.jsx)(p.kS,{})}),(0,y.jsx)(m.UQ,{title:"Beschreibung",className:(0,j.Tn)(B.description&&"border border-primary"),children:(0,y.jsx)(p.kz,{})}),(0,y.jsx)(m.UQ,{title:"Bilder",showSide:!0,sideClassName:"w-auto",className:(0,j.Tn)(B.files&&"border border-primary"),sideContent:g&&(0,y.jsx)(m.T2,(0,n.Z)((0,n.Z)({id:g.id},(null===g||void 0===g?void 0:g.file)&&{src:0===g.file.size?"".concat(D.T5,"media/").concat(null===g||void 0===g?void 0:g.id):URL.createObjectURL(g.file)}),{},{file:g.file,onHandle:function(e){N(e)},isTitleBild:(null===w||void 0===w?void 0:w.id)===g.id,onRemoveImage:function(e){K(M.findIndex((function(t){return t.id===e}))),k(null)}})),children:(0,y.jsx)("div",{className:"flex flex-wrap items-start justify-start",children:M.map((function(e,t){var i,l,d;return(0,y.jsx)(m.VA,(0,n.Z)((0,n.Z)({preview:!0,index:t,id:"files.".concat(t,".file"),handleAppend:X,handleShow:Y(e)},G("files.".concat(t,".file"))),{},{error:null===(i=B.files)||void 0===i||null===(l=i[t])||void 0===l||null===(d=l.file)||void 0===d?void 0:d.message},!!e.file&&{src:0!==e.file.size?URL.createObjectURL(e.file):"".concat(D.T5,"media/").concat(null===e||void 0===e?void 0:e.id)}),t)}))})}),(0,y.jsx)(p.Qv,{setSchedules:_,schedules:T}),(0,y.jsx)(m.iN,{loading:E,onSubmit:V(W)})]})}))}}}]);
//# sourceMappingURL=735.ee5d691b.chunk.js.map